image: pubsweet/pubsweet-test-base

install:
  stage: build
  script: yarn
  artifacts:
    expire_in: 1h
    paths:
      - node_modules
      - packages/*/node_modules
      - packages/components/packages/*/node_modules

lint:style:
  script:
    - npm run lint:style
    - docker ps -a -q | xargs -n1 -P 8 docker rm -f
    - docker volume ls -q | xargs -n1 -P 8 docker volume rm
    - docker image ls -q | xargs docker image rm -f

lint:js:
  script:
    - npm run lint:js
    - docker ps -a -q | xargs -n1 -P 8 docker rm -f
    - docker volume ls -q | xargs -n1 -P 8 docker volume rm
    - docker image ls -q | xargs docker image rm -f

test:
  script:
    - npm run test
    - docker ps -a -q | xargs -n1 -P 8 docker rm -f
    - docker volume ls -q | xargs -n1 -P 8 docker volume rm
    - docker image ls -q | xargs docker image rm -f

